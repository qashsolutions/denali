# Denali.health - Complete Application Tree

This document maps the entire PWA structure: screens, user flows, database tables, learning triggers, and agentic logic.

---

## Application Architecture

```
denali.health/
â”œâ”€â”€ ğŸ  Landing Page (Public)
â”œâ”€â”€ ğŸ’¬ Chat Interface (Core)
â”‚   â”œâ”€â”€ Coverage Guidance Flow (Free, No Auth)
â”‚   â””â”€â”€ Appeal Flow (Requires Phone OTP)
â”œâ”€â”€ ğŸ‘¤ Account Management
â”‚   â”œâ”€â”€ Authentication (OTP)
â”‚   â”œâ”€â”€ Settings
â”‚   â””â”€â”€ History
â”œâ”€â”€ ğŸ’³ Payments (Stripe)
â””â”€â”€ ğŸ§  Agentic Learning System (Background)
```

---

## Screen Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DENALI.HEALTH PWA                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“± PUBLIC (No Auth Required)                                               â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 00-landing-page.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ Marketing page                                                      â”‚â”‚
â”‚  â”‚   â€¢ "Get Started" â†’ Welcome                                             â”‚â”‚
â”‚  â”‚   â€¢ DB: None                                                            â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 01-welcome.svg / 01-welcome-light.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ App entry point (after PWA install)                                 â”‚â”‚
â”‚  â”‚   â€¢ "Ask about coverage" â†’ Coverage Flow                                â”‚â”‚
â”‚  â”‚   â€¢ "Help with a denial" â†’ Appeal Flow                                  â”‚â”‚
â”‚  â”‚   â€¢ Theme: Auto/Light/Dark                                              â”‚â”‚
â”‚  â”‚   â€¢ DB: conversations (device_fingerprint only)                         â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â””â”€â”€ 16-tablet-welcome.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚      â€¢ Tablet-optimized welcome (768x1024)                                 â”‚â”‚
â”‚      â€¢ Same logic as mobile welcome                                        â”‚â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ’¬ COVERAGE GUIDANCE FLOW (Free, Unlimited, No Auth)                       â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 02-conversation-intake.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ User describes situation in plain English                           â”‚â”‚
â”‚  â”‚   â€¢ "My mom needs a scan for her back pain"                             â”‚â”‚
â”‚  â”‚   â€¢ DB: conversations, messages                                         â”‚â”‚
â”‚  â”‚   â€¢ Learning: Extract symptoms â†’ queue mapping updates                  â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â”œâ”€â”€ 03-loading-coverage-check.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ MCP calls: CMS Coverage, ICD-10, NPI Registry                       â”‚â”‚
â”‚  â”‚   â€¢ Shows: "Checking Medicare policies..."                              â”‚â”‚
â”‚  â”‚   â€¢ DB: None (processing state)                                         â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â”œâ”€â”€ 10a-provider-zip-ask.svg (Optional) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ "What's your ZIP code?"                                             â”‚â”‚
â”‚  â”‚   â€¢ Needed to find local providers                                      â”‚â”‚
â”‚  â”‚   â€¢ DB: None                                                            â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â”œâ”€â”€ 10-provider-lookup.svg / 10b-provider-multi-select.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ NPI search by name + location                                       â”‚â”‚
â”‚  â”‚   â€¢ Multi-select if multiple matches                                    â”‚â”‚
â”‚  â”‚   â€¢ DB: messages.npi                                                    â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â””â”€â”€ 04-guidance-output.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚      â€¢ Coverage determination                                              â”‚â”‚
â”‚      â€¢ Documentation checklist                                             â”‚â”‚
â”‚      â€¢ "Medicare usually covers... but needs these documented..."          â”‚â”‚
â”‚      â€¢ ğŸ‘/ğŸ‘ feedback buttons                                              â”‚â”‚
â”‚      â€¢ DB: messages (icd10_codes, cpt_codes, policy_refs)                  â”‚â”‚
â”‚      â€¢ Learning: Store successful coverage path                            â”‚â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“ APPEAL FLOW (Requires Phone OTP for Letter)                             â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 06-appeal-denied-claim.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ User describes denial                                               â”‚â”‚
â”‚  â”‚   â€¢ "Medicare denied my MRI, help me appeal"                            â”‚â”‚
â”‚  â”‚   â€¢ Gather: denial date, reason, procedure                              â”‚â”‚
â”‚  â”‚   â€¢ DB: conversations (is_appeal=true), messages                        â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â”œâ”€â”€ 15-denial-not-covered.svg (Branch) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ If service is truly not covered                                     â”‚â”‚
â”‚  â”‚   â€¢ "Unfortunately, Medicare doesn't cover this service..."             â”‚â”‚
â”‚  â”‚   â€¢ Suggest alternatives if any                                         â”‚â”‚
â”‚  â”‚   â€¢ DB: messages                                                        â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â”œâ”€â”€ 07-appeal-letter-generator.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ Claude generates appeal letter (hidden)                             â”‚â”‚
â”‚  â”‚   â€¢ Shows preview: "Your appeal letter is ready!"                       â”‚â”‚
â”‚  â”‚   â€¢ DB: appeals (status='draft', letter NOT shown yet)                  â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â”‚              GATE: Check appeal_count for phone                   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ No phone (new)  â”‚ appeal_count=0  â”‚ appeal_countâ‰¥1  â”‚         â”‚   â”‚
â”‚  â”‚  â”‚  â”‚       â†“         â”‚       â†“         â”‚       â†“         â”‚         â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Signup Wall    â”‚  Show Letter    â”‚   Check Sub     â”‚         â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  (17-signup)    â”‚  (FREE!)        â”‚       â†“         â”‚         â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â”‚  â”‚           â”‚                 â”‚                 â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚           â–¼                 â”‚           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚  â”‚    18-mobile-otp.svg        â”‚           â”‚           â”‚             â”‚   â”‚
â”‚  â”‚  â”‚           â”‚                 â”‚        Has Sub    No Sub            â”‚   â”‚
â”‚  â”‚  â”‚           â–¼                 â”‚           â†“           â†“             â”‚   â”‚
â”‚  â”‚  â”‚    Show Letter (FREE)       â”‚      Show Letter  05-paywall        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â”œâ”€â”€ 17-signup-wall.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ "Your Appeal Letter is Ready!"                                      â”‚â”‚
â”‚  â”‚   â€¢ "Enter your phone number to view it â€” it's free"                    â”‚â”‚
â”‚  â”‚   â€¢ Phone number input                                                  â”‚â”‚
â”‚  â”‚   â€¢ DB: None (pre-auth state)                                           â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â”œâ”€â”€ 18-mobile-otp.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ 6-digit SMS code input                                              â”‚â”‚
â”‚  â”‚   â€¢ "Didn't receive code? Resend"                                       â”‚â”‚
â”‚  â”‚   â€¢ DB: users (created), user_verification (phone_verified=true)        â”‚â”‚
â”‚  â”‚   â”‚   â””â”€â”€ usage (phone, appeal_count=0)                                 â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â”œâ”€â”€ 05-paywall.svg (If appeal_count â‰¥ 1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ "You've used your free appeal"                                      â”‚â”‚
â”‚  â”‚   â€¢ Option A: $10 for this appeal                                       â”‚â”‚
â”‚  â”‚   â€¢ Option B: $25/month unlimited                                       â”‚â”‚
â”‚  â”‚   â€¢ DB: Check usage.appeal_count, subscriptions.status                  â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚    â–¼         â–¼                                                           â”‚
â”‚  â”‚  $10       $25/month                                                     â”‚
â”‚  â”‚    â”‚         â”‚                                                           â”‚
â”‚  â”‚    â”‚         â–¼                                                           â”‚
â”‚  â”‚    â”‚  13a-otp-email.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚    â”‚   â€¢ Email required for subscription                                â”‚â”‚
â”‚  â”‚    â”‚   â€¢ Account recovery + Stripe receipts                             â”‚â”‚
â”‚  â”‚    â”‚   â€¢ DB: users.email, user_verification.email_verified              â”‚â”‚
â”‚  â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚    â”‚         â”‚                                                           â”‚
â”‚  â”‚    â–¼         â–¼                                                           â”‚
â”‚  â”‚  [Stripe Checkout] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ One-time ($10) or Subscription ($25)                                â”‚â”‚
â”‚  â”‚   â€¢ DB: subscriptions (stripe_customer_id, status)                      â”‚â”‚
â”‚  â”‚   â”‚   â””â”€â”€ appeals (paid=true, stripe_payment_id)                        â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â””â”€â”€ [Appeal Letter Revealed] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚      â€¢ Full letter with citations                                          â”‚â”‚
â”‚      â€¢ Print / Copy / Download / Share                                     â”‚â”‚
â”‚      â€¢ "Report outcome" button (for learning)                              â”‚â”‚
â”‚      â€¢ DB: appeals (status='sent'), usage.appeal_count++                   â”‚â”‚
â”‚      â€¢ Learning: Store coverage path, track print/copy events              â”‚â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ‘¤ ACCOUNT & SETTINGS (Requires Auth)                                      â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 12-onboarding-auth.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ "Continue with Phone" / "Continue with Email"                       â”‚â”‚
â”‚  â”‚   â€¢ Phone is primary, email for paid tier                               â”‚â”‚
â”‚  â”‚   â€¢ DB: auth.users                                                      â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚         â”‚                                                                â”‚
â”‚  â”‚         â–¼                                                                â”‚
â”‚  â”œâ”€â”€ 13-otp-verification.svg / 13b-otp-mobile.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ OTP code entry                                                      â”‚â”‚
â”‚  â”‚   â€¢ DB: user_verification                                               â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 08-history.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ Past conversations and appeals                                      â”‚â”‚
â”‚  â”‚   â€¢ Tap to continue conversation                                        â”‚â”‚
â”‚  â”‚   â€¢ DB: SELECT FROM conversations WHERE user_id = auth.uid()            â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ 09-account-settings.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â€¢ Profile info                                                        â”‚â”‚
â”‚  â”‚   â€¢ Subscription management                                             â”‚â”‚
â”‚  â”‚   â€¢ Notifications toggle                                                â”‚â”‚
â”‚  â”‚   â€¢ Theme selection                                                     â”‚â”‚
â”‚  â”‚   â€¢ "Delete Account" (danger zone)                                      â”‚â”‚
â”‚  â”‚   â€¢ DB: users, subscriptions                                            â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â””â”€â”€ 14-accessibility-settings.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚      â€¢ Text size slider (0.8x - 1.5x)                                      â”‚â”‚
â”‚      â€¢ High contrast toggle                                                â”‚â”‚
â”‚      â€¢ Reduce motion toggle                                                â”‚â”‚
â”‚      â€¢ Autoplay media toggle                                               â”‚â”‚
â”‚      â€¢ VoiceOver optimization                                              â”‚â”‚
â”‚      â€¢ DB: users (text_size, high_contrast, reduce_motion, etc.)           â”‚â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  âš ï¸ ERROR STATES                                                            â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â””â”€â”€ 11-error-offline.svg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚      â€¢ "You're offline"                                                    â”‚â”‚
â”‚      â€¢ Retry button                                                        â”‚â”‚
â”‚      â€¢ Cached content still accessible                                     â”‚â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Table Mapping

### By User Journey Stage

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATABASE USAGE BY FLOW                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ANONYMOUS USER (Coverage Guidance)                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  conversations â†â”€â”€ device_fingerprint (analytics only)                      â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â””â”€â”€ messages â†â”€â”€ content, icd10_codes, cpt_codes, policy_refs         â”‚
â”‚                                                                             â”‚
â”‚  LEARNING (No User Link):                                                   â”‚
â”‚  â€¢ symptom_mappings â†â”€â”€ phrase â†’ icd10_code (confidence++)                  â”‚
â”‚  â€¢ procedure_mappings â†â”€â”€ phrase â†’ cpt_code (confidence++)                  â”‚
â”‚  â€¢ coverage_paths â†â”€â”€ successful code combinations                          â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  FREE USER (After Phone OTP)                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚  users â†â”€â”€ phone (PRIMARY), plan='free'                                     â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ user_verification â†â”€â”€ phone_verified=true                         â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ usage â†â”€â”€ phone, appeal_count (0 â†’ 1)                             â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â””â”€â”€ conversations â†â”€â”€ user_id, phone                                  â”‚
â”‚                â”‚                                                            â”‚
â”‚                â”œâ”€â”€ messages                                                 â”‚
â”‚                â”‚                                                            â”‚
â”‚                â””â”€â”€ appeals â†â”€â”€ phone, appeal_letter, paid=false             â”‚
â”‚                                                                             â”‚
â”‚  LEARNING:                                                                  â”‚
â”‚  â€¢ user_feedback â†â”€â”€ message_id, rating, correction                         â”‚
â”‚  â€¢ user_events â†â”€â”€ phone, event_type (print, copy, download)                â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  PAID USER ($10 or $25/month)                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚  users â†â”€â”€ phone, email, plan='per_appeal' or 'unlimited'                   â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ user_verification â†â”€â”€ phone_verified=true, email_verified=true    â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ subscriptions â†â”€â”€ stripe_customer_id, status='active'             â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ usage â†â”€â”€ phone, appeal_count (unlimited)                         â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â””â”€â”€ conversations                                                     â”‚
â”‚                â”‚                                                            â”‚
â”‚                â”œâ”€â”€ messages                                                 â”‚
â”‚                â”‚                                                            â”‚
â”‚                â””â”€â”€ appeals â†â”€â”€ paid=true, stripe_payment_id                 â”‚
â”‚                                                                             â”‚
â”‚  LEARNING:                                                                  â”‚
â”‚  â€¢ appeal_outcomes â†â”€â”€ outcome, denial_reason, documentation_gaps           â”‚
â”‚  â€¢ user_events â†â”€â”€ upgrade, cancel events                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## SQL Functions by Use Case

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FUNCTION CALL MAPPING                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  APPEAL ACCESS CHECK (Before showing letter)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚                                                                             â”‚
â”‚  check_appeal_access(phone) â†’ 'free' | 'paywall' | 'allowed'                â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ 'free' â†’ Show letter, then increment_appeal_count(phone)          â”‚
â”‚       â”œâ”€â”€ 'paywall' â†’ Show 05-paywall.svg                                   â”‚
â”‚       â””â”€â”€ 'allowed' â†’ Show letter (subscription active)                     â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  APPEAL COUNT MANAGEMENT                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚                                                                             â”‚
â”‚  get_appeal_count(phone) â†’ INTEGER                                          â”‚
â”‚       â””â”€â”€ Returns 0 for new users                                           â”‚
â”‚                                                                             â”‚
â”‚  increment_appeal_count(phone, user_id?, device_fingerprint?) â†’ INTEGER     â”‚
â”‚       â””â”€â”€ Inserts or updates usage table, returns new count                 â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  FEEDBACK & LEARNING                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚                                                                             â”‚
â”‚  process_feedback(message_id, 'up'|'down', correction?)                     â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ 'up' â†’ confidence += 0.1 for all mappings in conversation         â”‚
â”‚       â””â”€â”€ 'down' â†’ confidence -= 0.15, queue review if correction given     â”‚
â”‚                                                                             â”‚
â”‚  update_symptom_mapping(phrase, icd10, description?, boost?)                â”‚
â”‚       â””â”€â”€ Upsert with confidence adjustment                                 â”‚
â”‚                                                                             â”‚
â”‚  update_procedure_mapping(phrase, cpt, description?, boost?)                â”‚
â”‚       â””â”€â”€ Upsert with confidence adjustment                                 â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  OUTCOME TRACKING (User reports appeal result)                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚                                                                             â”‚
â”‚  record_appeal_outcome(appeal_id, outcome, denial_reason?, gaps?, ...)      â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ Stores in appeal_outcomes                                         â”‚
â”‚       â”œâ”€â”€ Updates appeals.status                                            â”‚
â”‚       â”œâ”€â”€ Calls update_coverage_path()                                      â”‚
â”‚       â”œâ”€â”€ Queues learning job                                               â”‚
â”‚       â””â”€â”€ Tracks user_event                                                 â”‚
â”‚                                                                             â”‚
â”‚  update_coverage_path(icd10[], cpt[], ncd[], lcd[], outcome, gaps?)         â”‚
â”‚       â””â”€â”€ Updates coverage_paths success/failure rates                      â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  LEARNING SYSTEM (Background)                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚                                                                             â”‚
â”‚  queue_learning_job(type, data, priority) â†’ UUID                            â”‚
â”‚       â””â”€â”€ Types: update_symptom_mapping, analyze_outcome_pattern, etc.      â”‚
â”‚                                                                             â”‚
â”‚  claim_learning_job() â†’ (job_id, job_type, job_data)                        â”‚
â”‚       â””â”€â”€ Worker claims next pending job                                    â”‚
â”‚                                                                             â”‚
â”‚  complete_learning_job(job_id, success, error?)                             â”‚
â”‚       â””â”€â”€ Mark job done                                                     â”‚
â”‚                                                                             â”‚
â”‚  get_learning_context(symptoms?, procedures?, limit) â†’ JSONB                â”‚
â”‚       â””â”€â”€ Returns mappings + paths for Claude prompts                       â”‚
â”‚                                                                             â”‚
â”‚  prune_weak_mappings(threshold?, days?) â†’ TABLE                             â”‚
â”‚       â””â”€â”€ Nightly cleanup of low-confidence mappings                        â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  USER EVENTS (Analytics)                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚                                                                             â”‚
â”‚  track_user_event(phone, type, data?, conversation_id?, appeal_id?, ...)    â”‚
â”‚       â””â”€â”€ Types: print, copy, download, share, upgrade, cancel, etc.        â”‚
â”‚                                                                             â”‚
â”‚  update_conversation_pattern(trigger, intent, sequence, was_successful)     â”‚
â”‚       â””â”€â”€ Learn optimal question flows                                      â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ACCOUNT DELETION (GDPR/CCPA)                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚                                                                             â”‚
â”‚  delete_user_cascade(user_id)                                               â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ Delete: user_feedback, appeals, messages, conversations           â”‚
â”‚       â”œâ”€â”€ Delete: usage, subscriptions, user_verification, users            â”‚
â”‚       â””â”€â”€ Retain: symptom_mappings, procedure_mappings, coverage_paths      â”‚
â”‚                   (anonymized learning data)                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Agentic Learning Triggers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LEARNING TRIGGER POINTS                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â‘  EVERY MESSAGE                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  User says: "My back is killing me"                                         â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ Extract entities: "back pain" â†’ M54.5                             â”‚
â”‚       â”œâ”€â”€ queue_learning_job('update_symptom_mapping', {...})               â”‚
â”‚       â””â”€â”€ symptom_mappings.confidence += 0.05                               â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â‘¡ FEEDBACK (ğŸ‘/ğŸ‘)                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  User taps ğŸ‘ on guidance message                                           â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ process_feedback(message_id, 'up')                                â”‚
â”‚       â”œâ”€â”€ All mappings in conversation: confidence += 0.1                   â”‚
â”‚       â””â”€â”€ conversation_patterns: success_rate += 0.1                        â”‚
â”‚                                                                             â”‚
â”‚  User taps ğŸ‘ with correction: "No, it's kidney pain"                       â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ process_feedback(message_id, 'down', 'kidney pain')               â”‚
â”‚       â”œâ”€â”€ Original mapping: confidence -= 0.15                              â”‚
â”‚       â”œâ”€â”€ queue_learning_job('analyze_outcome_pattern', {...})              â”‚
â”‚       â””â”€â”€ New mapping created: "back is killing me" â†’ N23 (renal)           â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â‘¢ APPEAL LETTER GENERATED                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  Appeal letter created with codes and citations                             â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ Store coverage path: M54.5 + 72148 + LCD L12345 â†’ pending         â”‚
â”‚       â”œâ”€â”€ track_user_event(phone, 'appeal_completed', {...})                â”‚
â”‚       â””â”€â”€ Await outcome report for learning                                 â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â‘£ USER REPORTS OUTCOME                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚  User returns: "My appeal was approved!"                                    â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ record_appeal_outcome(appeal_id, 'approved', ...)                 â”‚
â”‚       â”œâ”€â”€ coverage_paths: M54.5 + 72148 â†’ outcome = 'approved'              â”‚
â”‚       â”œâ”€â”€ Mappings used: confidence += 0.15                                 â”‚
â”‚       â””â”€â”€ Queue pattern analysis for learning                               â”‚
â”‚                                                                             â”‚
â”‚  User returns: "They denied it again..."                                    â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ record_appeal_outcome(appeal_id, 'denied', reason, gaps)          â”‚
â”‚       â”œâ”€â”€ coverage_paths: outcome = 'denied'                                â”‚
â”‚       â”œâ”€â”€ Mappings used: confidence -= 0.1                                  â”‚
â”‚       â””â”€â”€ Learn from denial_reason and documentation_gaps                   â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â‘¤ CONTENT ACTIONS                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  User prints appeal letter                                                  â”‚
â”‚       â””â”€â”€ track_user_event(phone, 'print', {appeal_id})                     â”‚
â”‚                                                                             â”‚
â”‚  User copies appeal letter                                                  â”‚
â”‚       â””â”€â”€ track_user_event(phone, 'copy', {appeal_id})                      â”‚
â”‚                                                                             â”‚
â”‚  User downloads appeal letter                                               â”‚
â”‚       â””â”€â”€ track_user_event(phone, 'download', {appeal_id})                  â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â‘¥ NIGHTLY BATCH JOBS                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚  Scheduled function runs at 2am                                             â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”œâ”€â”€ Process learning_queue (pending jobs)                             â”‚
â”‚       â”œâ”€â”€ prune_weak_mappings(0.3, 90) â€” remove low-confidence              â”‚
â”‚       â”œâ”€â”€ Aggregate conversation_patterns                                   â”‚
â”‚       â”œâ”€â”€ Check policy_cache for CMS updates                                â”‚
â”‚       â””â”€â”€ Generate learning metrics report                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## RLS Policy Mapping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ROW LEVEL SECURITY                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  USER DATA (Requires auth.uid())                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚  users              â†’ SELECT/UPDATE own row (auth.uid() = id)               â”‚
â”‚  user_verification  â†’ SELECT own row (auth.uid() = user_id)                 â”‚
â”‚  subscriptions      â†’ SELECT own row (auth.uid() = user_id)                 â”‚
â”‚  usage              â†’ SELECT own row (auth.uid() = user_id)                 â”‚
â”‚  conversations      â†’ SELECT/INSERT/UPDATE own (auth.uid() = user_id)       â”‚
â”‚  messages           â†’ SELECT/INSERT via conversation ownership              â”‚
â”‚  appeals            â†’ SELECT/INSERT/UPDATE own (auth.uid() = user_id)       â”‚
â”‚  user_feedback      â†’ SELECT/INSERT on own conversation messages            â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  LEARNING DATA (Public read, system write)                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚  symptom_mappings      â†’ SELECT: anyone | INSERT/UPDATE: service role only  â”‚
â”‚  procedure_mappings    â†’ SELECT: anyone | INSERT/UPDATE: service role only  â”‚
â”‚  coverage_paths        â†’ SELECT: anyone | INSERT/UPDATE: service role only  â”‚
â”‚  conversation_patterns â†’ SELECT: anyone | INSERT/UPDATE: service role only  â”‚
â”‚  policy_cache          â†’ SELECT: anyone | INSERT/UPDATE: service role only  â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  USER-LINKED LEARNING (Own data only)                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  appeal_outcomes â†’ SELECT where users.phone = appeal_outcomes.phone         â”‚
â”‚  user_events     â†’ SELECT where users.phone = user_events.phone             â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  SYSTEM ONLY (No client access)                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚  learning_queue â†’ No policies (service role only via Edge Functions)        â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ANONYMOUS ACCESS PATTERN                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚  Coverage guidance (no auth) works via Edge Functions:                      â”‚
â”‚  1. Client sends device_fingerprint                                         â”‚
â”‚  2. Edge Function uses service role key (bypasses RLS)                      â”‚
â”‚  3. Creates conversation with user_id=NULL                                  â”‚
â”‚  4. RLS INSERT policy allows user_id IS NULL for Edge Functions             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Reference

### Documentation Files
| File | Purpose |
|------|---------|
| `README.md` | Project overview |
| `01-scope.md` | Project scope and features |
| `02-user-flow.md` | User journey descriptions |
| `03-architecture.md` | Technical architecture |
| `04-skills.md` | Claude capabilities |
| `05-database.md` | Database schema docs |
| `06-business.md` | Pricing and business model |
| `07-ui.md` | UI/UX guidelines |
| `08-learning.md` | Agentic learning system |
| `09-app-tree.md` | This file - complete app mapping |

### Mockup Files (24 total)
| File | Screen | Auth Required |
|------|--------|---------------|
| `00-landing-page.svg` | Marketing landing | No |
| `01-welcome.svg` | App entry (dark) | No |
| `01-welcome-light.svg` | App entry (light) | No |
| `02-conversation-intake.svg` | Chat input | No |
| `03-loading-coverage-check.svg` | Loading state | No |
| `04-guidance-output.svg` | Coverage result | No |
| `05-paywall.svg` | Payment wall | Phone OTP |
| `06-appeal-denied-claim.svg` | Appeal intake | No |
| `07-appeal-letter-generator.svg` | Letter preview | Phone OTP |
| `08-history.svg` | Conversation history | Phone OTP |
| `09-account-settings.svg` | Settings | Phone OTP |
| `10-provider-lookup.svg` | NPI search | No |
| `10a-provider-zip-ask.svg` | ZIP input | No |
| `10b-provider-multi-select.svg` | Provider select | No |
| `11-error-offline.svg` | Offline error | No |
| `12-onboarding-auth.svg` | Auth options | No |
| `13-otp-verification.svg` | OTP entry | No |
| `13a-otp-email.svg` | Email OTP | Phone OTP |
| `13b-otp-mobile.svg` | Phone OTP | No |
| `14-accessibility-settings.svg` | A11y settings | Phone OTP |
| `15-denial-not-covered.svg` | Not covered | No |
| `16-tablet-welcome.svg` | Tablet welcome | No |
| `17-signup-wall.svg` | Phone signup | No |
| `18-mobile-otp.svg` | Phone verify | No |

### SQL Files
| File | Purpose |
|------|---------|
| `sql/001-schema.sql` | Complete database schema |

---

## Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DENALI.HEALTH AT A GLANCE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“Š TOTALS                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  â€¢ 24 SVG mockups                                                           â”‚
â”‚  â€¢ 16 database tables                                                       â”‚
â”‚  â€¢ 17 SQL functions                                                         â”‚
â”‚  â€¢ 39 indexes                                                               â”‚
â”‚  â€¢ 22 RLS policies                                                          â”‚
â”‚  â€¢ 10 documentation files                                                   â”‚
â”‚                                                                             â”‚
â”‚  ğŸ’° PRICING                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                  â”‚
â”‚  â€¢ Coverage guidance: FREE (unlimited, no signup)                           â”‚
â”‚  â€¢ First appeal: FREE (phone OTP required)                                  â”‚
â”‚  â€¢ Additional appeals: $10 each OR $25/month unlimited                      â”‚
â”‚                                                                             â”‚
â”‚  ğŸ” AUTH                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€                                                                     â”‚
â”‚  â€¢ Phone OTP: Primary identifier, required for appeals                      â”‚
â”‚  â€¢ Email OTP: Required for $25/month subscription only                      â”‚
â”‚  â€¢ Device fingerprint: Analytics only, not for gating                       â”‚
â”‚                                                                             â”‚
â”‚  ğŸ§  LEARNING                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                 â”‚
â”‚  â€¢ Symptom mappings: phrase â†’ ICD-10 (confidence-based)                     â”‚
â”‚  â€¢ Procedure mappings: phrase â†’ CPT (confidence-based)                      â”‚
â”‚  â€¢ Coverage paths: successful code combinations                             â”‚
â”‚  â€¢ Appeal outcomes: real-world results                                      â”‚
â”‚  â€¢ Conversation patterns: optimal question sequences                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
